 
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>提交订单2</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/tijiaodiandan2.css">


</head>
<body>
<iframe id="sina_anywhere_iframe" style="display: none;"></iframe>
<!-- top -->
<div class="top-con">
    
    </div>

<!-- 头部开始 -->
<section class="p-common-header">
    <div class="topnav">
        <div class="content clearfix">
        <span class="pull-left">
          <span class="pull-left p-common-region" id="region"> <i class="iconfont"></i>
            <a href="javascript:;" class="topnav-region link-gray">
                上海 <i class="iconfont"></i>
            </a>
            <div class="p-common-regionCon hide" id="regSel">
                <h5>热门城市:</h5>
                <ul class="list-unstyled clearfix hotcity">
                                        <li>
                        <a href="javascript:;" data-id="106092">上海</a>
                    </li>
                                        <li>
                        <a href="javascript:;" data-id="144261">广州</a>
                    </li>
                                        <li>
                        <a href="javascript:;" data-id="143949">北京</a>
                    </li>
                                        <li>
                        <a href="javascript:;" data-id="144422">深圳</a>
                    </li>
                                        <li>
                        <a href="javascript:;" data-id="144444">成都</a>
                    </li>
                                    </ul>
                <h5>选择城市:</h5>
                <ul class="list-unstyled regionsel">
                                                            <li>
                        <a href="javascript:;" data-id="106092">上海</a>
                    </li>
                                                                                <li>
                        <a href="javascript:;" data-id="145855">上海郊区</a>
                    </li>
                                                                                <li>
                        <a href="javascript:;" class="provicesel">
                            <span class="pull-right">
                              <i class="iconfont"></i>
                            </span>
                            江苏
                        </a>
                        <div class="citysel">
                                                        <a href="javascript:;" data-id="14270">常州</a>
                                                        <a href="javascript:;" data-id="31710">淮安</a>
                                                        <a href="javascript:;" data-id="28260">连云港</a>
                                                        <a href="javascript:;" data-id="2">南京</a>
                                                        <a href="javascript:;" data-id="23730">南通</a>
                                                        <a href="javascript:;" data-id="17771">苏州</a>
                                                        <a href="javascript:;" data-id="42749">泰州</a>
                                                        <a href="javascript:;" data-id="4536">无锡</a>
                                                        <a href="javascript:;" data-id="46290">宿迁</a>
                                                        <a href="javascript:;" data-id="9135">徐州</a>
                                                        <a href="javascript:;" data-id="49184">盐城</a>
                                                        <a href="javascript:;" data-id="36177">扬州</a>
                                                        <a href="javascript:;" data-id="39980">镇江</a>
                                                    </div>
                    </li>
                                                                                <li>
                        <a href="javascript:;" class="provicesel">
                            <span class="pull-right">
                              <i class="iconfont"></i>
                            </span>
                            浙江
                        </a>
                        <div class="citysel">
                                                        <a href="javascript:;" data-id="54352">杭州</a>
                                                        <a href="javascript:;" data-id="78239">湖州</a>
                                                        <a href="javascript:;" data-id="74881">嘉兴</a>
                                                        <a href="javascript:;" data-id="84713">金华</a>
                                                        <a href="javascript:;" data-id="101443">丽水</a>
                                                        <a href="javascript:;" data-id="61841">宁波</a>
                                                        <a href="javascript:;" data-id="90123">衢州</a>
                                                        <a href="javascript:;" data-id="81106">绍兴</a>
                                                        <a href="javascript:;" data-id="96033">台州</a>
                                                        <a href="javascript:;" data-id="68453">温州</a>
                                                        <a href="javascript:;" data-id="93628">舟山</a>
                                                    </div>
                    </li>
                                                                                <li>
                        <a href="javascript:;" class="provicesel">
                            <span class="pull-right">
                              <i class="iconfont"></i>
                            </span>
                            安徽
                        </a>
                        <div class="citysel">
                                                        <a href="javascript:;" data-id="116543">安庆</a>
                                                        <a href="javascript:;" data-id="110702">蚌埠</a>
                                                        <a href="javascript:;" data-id="140334">亳州</a>
                                                        <a href="javascript:;" data-id="142739">池州</a>
                                                        <a href="javascript:;" data-id="122473">滁州</a>
                                                        <a href="javascript:;" data-id="126555">阜阳</a>
                                                        <a href="javascript:;" data-id="106341">合肥</a>
                                                        <a href="javascript:;" data-id="114716">淮北</a>
                                                        <a href="javascript:;" data-id="112546">淮南</a>
                                                        <a href="javascript:;" data-id="120049">黄山</a>
                                                        <a href="javascript:;" data-id="136386">六安</a>
                                                        <a href="javascript:;" data-id="113743">马鞍山</a>
                                                        <a href="javascript:;" data-id="115943">铜陵</a>
                                                        <a href="javascript:;" data-id="109303">芜湖</a>
                                                        <a href="javascript:;" data-id="130770">宿州</a>
                                                        <a href="javascript:;" data-id="144431">宣城</a>
                                                    </div>
                    </li>
                                                                                <li>
                        <a href="javascript:;" data-id="143949">北京</a>
                    </li>
                                                                                <li>
                        <a href="javascript:;" data-id="145874">北京（五环外）</a>
                    </li>
                                                                                <li>
                        <a href="javascript:;" data-id="144005">天津</a>
                    </li>
                                                                                <li>
                        <a href="javascript:;" class="provicesel">
                            <span class="pull-right">
                              <i class="iconfont"></i>
                            </span>
                            河北
                        </a>
                        <div class="citysel">
                                                        <a href="javascript:;" data-id="143984">石家庄</a>
                                                        <a href="javascript:;" data-id="144032">廊坊</a>
                                                        <a href="javascript:;" data-id="144033">承德</a>
                                                        <a href="javascript:;" data-id="144034">唐山</a>
                                                        <a href="javascript:;" data-id="144660">保定</a>
                                                        <a href="javascript:;" data-id="144668">沧州</a>
                                                        <a href="javascript:;" data-id="144677">邯郸</a>
                                                        <a href="javascript:;" data-id="144684">衡水</a>
                                                        <a href="javascript:;" data-id="144690">秦皇岛</a>
                                                        <a href="javascript:;" data-id="144694">邢台</a>
                                                        <a href="javascript:;" data-id="144700">张家口</a>
                                                    </div>
                    </li>
                                                                                <li>
                        <a href="javascript:;" class="provicesel">
                            <span class="pull-right">
                              <i class="iconfont"></i>
                            </span>
                            广东
                        </a>
                        <div class="citysel">
                                                        <a href="javascript:;" data-id="144422">深圳</a>
                                                        <a href="javascript:;" data-id="144261">广州</a>
                                                        <a href="javascript:;" data-id="144274">珠海</a>
                                                        <a href="javascript:;" data-id="144278">汕头</a>
                                                        <a href="javascript:;" data-id="144285">韶关</a>
                                                        <a href="javascript:;" data-id="144296">佛山</a>
                                                        <a href="javascript:;" data-id="144302">江门</a>
                                                        <a href="javascript:;" data-id="144313">湛江</a>
                                                        <a href="javascript:;" data-id="144321">茂名</a>
                                                        <a href="javascript:;" data-id="144328">肇庆</a>
                                                        <a href="javascript:;" data-id="144334">惠州</a>
                                                        <a href="javascript:;" data-id="144338">梅州</a>
                                                        <a href="javascript:;" data-id="144341">汕尾</a>
                                                        <a href="javascript:;" data-id="144345">河源</a>
                                                        <a href="javascript:;" data-id="144347">阳江</a>
                                                        <a href="javascript:;" data-id="144351">清远</a>
                                                        <a href="javascript:;" data-id="144355">东莞</a>
                                                        <a href="javascript:;" data-id="144357">中山</a>
                                                        <a href="javascript:;" data-id="144359">揭阳</a>
                                                        <a href="javascript:;" data-id="144364">云浮</a>
                                                        <a href="javascript:;" data-id="144367">潮州</a>
                                                    </div>
                    </li>
                                                                                <li>
                        <a href="javascript:;" class="provicesel">
                            <span class="pull-right">
                              <i class="iconfont"></i>
                            </span>
                            四川
                        </a>
                        <div class="citysel">
                                                        <a href="javascript:;" data-id="144444">成都</a>
                                                        <a href="javascript:;" data-id="144508">巴中</a>
                                                        <a href="javascript:;" data-id="144510">达州</a>
                                                        <a href="javascript:;" data-id="144517">德阳</a>
                                                        <a href="javascript:;" data-id="144513">广安</a>
                                                        <a href="javascript:;" data-id="144502">广元</a>
                                                        <a href="javascript:;" data-id="144499">乐山</a>
                                                        <a href="javascript:;" data-id="144494">泸州</a>
                                                        <a href="javascript:;" data-id="145541">眉山</a>
                                                        <a href="javascript:;" data-id="144472">绵阳</a>
                                                        <a href="javascript:;" data-id="144487">南充</a>
                                                        <a href="javascript:;" data-id="144482">内江</a>
                                                        <a href="javascript:;" data-id="144479">遂宁</a>
                                                        <a href="javascript:;" data-id="144504">宜宾</a>
                                                        <a href="javascript:;" data-id="145547">资阳</a>
                                                        <a href="javascript:;" data-id="144450">自贡</a>
                                                        <a href="javascript:;" data-id="144515">雅安</a>
                                                    </div>
                    </li>
                                                                                <li>
                        <a href="javascript:;" data-id="144522">重庆</a>
                    </li>
                                                        </ul>

            </div>
          </span>
                    满百包邮（环郊内）
          <a href="/xyd" class="link-VI2" target="_blank">星夜达</a>
                    </span>

            <ul class="pull-right list-inline">
                                <li>
                    <span class="pull-left">您好，</span>
                    <a href="/user" class="link-gray pull-left" target="_blank">15234142931</a>
                    <a href="/ajax/login/logout" class="link-gray pull-left">退出</a>

                    <div class="p-common-topsubnav pull-left">
                        我的果园
                        <div class="p-common-topmygarden hide">
                            <dl class="clearfix">
                                <dt><span class="level v0"></span>
                                    <img class="img-circle" src="http://cdn.fruitday.com/up_images/default_userpic.png" alt="">
                                </dt>
                                <dd>
                                    <span>欢迎您</span>
                                    <p>15234142931</p>
                                </dd>
                            </dl>
                            <ul class="list-unstyled clearfix">
                                <li>
                                    <a href="/user/orders" target="_blank">我的订单</a>
                                </li>
                                <li>
                                    <a href="/user/tryeat" target="_blank">我的试吃</a>
                                </li>
                                <li>
                                    <a href="/user/jfget" target="_blank">我的积分</a>
                                </li>
                                <li>
                                    <a href="/user/coupon" target="_blank">我的优惠券</a>
                                </li>
                                <li>
                                    <a href="/user/transaction" target="_blank">帐户余额</a>
                                </li>
                                <li>
                                    <a href="/user/recharge" target="_blank">在线充值</a>
                                </li>
                                <li>
                                    <a href="/user/address" target="_blank">收货地址</a>
                                </li>
                                <li>
                                    <a href="/user/giftsget" target="_blank">领取赠品</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                                <li>|</li>

                <li class="p-common-topsubnav">
                    果园公告
                    <!--<span class="tipscircle"></span>-->
                    <div class="p-common-noticelist hide">
                        <ul class="list-unstyled">
                                                        <li>
                                <a href="/notice/detail/791" target="_blank">北京成都仓充值商品调整</a>
                                <em>new</em>                            </li>
                                                        <li>
                                <a href="/notice/detail/790" target="_blank">广州仓满赠商品变更</a>
                                <em>new</em>                            </li>
                                                        <li>
                                <a href="/notice/detail/789" target="_blank">上海广州仓充值商品调整</a>
                                <em>new</em>                            </li>
                                                    </ul>
                        <div class="text-center"><a href="/notice" target="_blank">查看更多 &gt;</a></div>
                    </div>
                </li>
                <li>|</li>
                <li>
                    <a href="/web/card_change" class="link-gray pull-left" target="_blank">券卡兑换</a>
                </li>
                <li>|</li>
                <li class="p-common-topsubnav">
                    <i class="iconfont"></i>
                    手机果园
                    <div class="p-common-topcode hide">
                        <div class="text-center">
                            <span class="VI-color2">下载果园app，</span>
                            即享果园特价商品
                        </div>
                        <dl class="clearfix">
                            <dt>
                                <img src="http://img1.fruitday.com/guan_ewcode2.jpg" alt="">
                            </dt>
                            <dd>
                                <a href="https://itunes.apple.com/us/app/tian-tian-guo-yuan-fruitday/id880977721" target="_blank">
                                    <img src="http://img2.fruitday.com/guan_btn01.jpg" alt="">
                                </a>
                                <a href="http://cdn.fruitday.com/fruitday.apk" target="_blank">
                                    <img src="http://img2.fruitday.com/guan_btn02.jpg" alt="">
                                </a>
                            </dd>
                        </dl>
                        <dl class="clearfix">
                            <dt>
                                <img src="http://img1.fruitday.com/guan_ewcode1.jpg" alt="">
                            </dt>
                            <dd>
                                <span class="VI-color2">关注果园微信</span>
                                优惠信息实时掌握
                            </dd>
                        </dl>
                    </div>
                </li>
                <li>|</li>
                <li>
                    <i class="iconfont"></i> <b>400-720-0770</b>
                </li>
            </ul>
        </div>
    </div>
        <div class="content">
        <nav class="navbar ">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand logo" href="/"></a>
                </div>
                <div class="collapse navbar-collapse">
                                    <ul class="icons-cart clearfix pull-right list-unstyled">
                        <li class="pull-left li1 cur">
                            <span>1</span>
                            <p>我的购物车</p>
                        </li>
                        <li class="pull-left li2 cur">
                            <span>2</span>
                            <p>确认订单信息</p>
                        </li>
                        <li class="pull-left li3">
                            <span>3</span>
                            <p>成功提交订单</p>
                        </li>
                    </ul>
                                    </div>
            </div>
        </nav>
    </div>
</section>


<input type="hidden" id="api_msg_type" value="">
<input type="hidden" id="api_msg" value="">
<input type="hidden" id="api_goto_url" value="">
<input type="hidden" id="order_error" value="">

<!-- 下单开始 -->
<section class="p-component-order" id="p-order">
    <h3><i class="iconfont pull-left"></i>填写并核对订单信息</h3>
    <h4><a href="javascript:;" class="pull-right" id="newAddress">新增收货地址</a>收货人信息</h4>
    <div class="order-item">
                <ul class="list-unstyled clearfix order-item-addresslist" id="orderAddressList">
                    </ul>
        <ul class="list-unstyled order-item-addresslist" id="orderAddressSwitch">
            <li>
                <span class="more">
                    <b>更多地址</b>
                    <a class=""></a>
                </span>
            </li>
        </ul>
            </div>
    <h4>支付方式</h4>
    <div class="order-item">
        <ul class="list-unstyled clearfix order-item-paylist" id="orderPayList">
            <li data-id="1|0" class="cur">在线支付</li>
            <!--<li data-id="1|0" class="curr">网银支付</li>-->
            <!--<li id="sc_payoff" data-id="4|1" >货到付款</li>-->
            <li id="sc_payoff" data-id="1|0" class="balancepay payarrival"><p id="offname">线下支付</p>
                <div class="paytips payways" style="display: none;">
                    <i class="iconfont"></i>
                                        <p>货到付现金<em style="display: none">|1</em></p>
                                        <p>货到刷银行卡<em style="display: none">|2</em></p>
                                        <p>红色储值卡<em style="display: none">|7</em></p>
                                        <p>金色储值卡<em style="display: none">|8</em></p>
                                        <p>果实卡<em style="display: none">|9</em></p>
                                        <p>通用券/代金券<em style="display: none">|11</em></p>
                                    </div>
            </li>
            <li data-id="5|0" class="balancepay">余额支付
                <div class="paytips" style="display: none;">
                    <i class="iconfont"></i>
                    您的余额是：0.00元 <span class="fc-red">余额不足，<a href="/user/recharge" target="_blank">立即充值</a></span>                </div>
            </li>
        </ul>
    </div>
    <h4><a href="/cart" class="pull-right">修改购物车</a>配送信息</h4>
    <div class="order-item clearfix">
        <ul class="order-item-cartlist list-unstyled pull-right">
                       <li>
                <dl class="list-unstyled clearfix">
                    <dt><img src="http://cdn.fruitday.com/images/product_pic/10155/1/1-270x270-10155-HC3SU27H.jpg" alt=""></dt>
                    <dd>
                        <div class="protitle">美国粉色柠檬</div>
                        <div class="proinfo">￥39.90 / 4个 <span>x 1</span></div>
                        <!-- <span class="protag">赠品</span> -->
                    </dd>
                </dl>
            </li>
                        <li>
                <dl class="list-unstyled clearfix">
                    <dt><img src="http://cdn.fruitday.com/images/product_pic/10361/1/1-270x270-10361-858DP2DF.jpg" alt=""></dt>
                    <dd>
                        <div class="protitle">南汇玉菇甜瓜</div>
                        <div class="proinfo">￥49.90 / 1个 <span>x 1</span></div>
                        <!-- <span class="protag">赠品</span> -->
                    </dd>
                </dl>
            </li>
                    </ul>
        <div class="order-item-sendinfo pull-left" id="orderSendInfo">
            <h5 class="clearfix"><a href="javascript:;" class="pull-right" id="modifyTime">修改</a><span class="pull-left">配送时间</span><p class="pull-left">无</p></h5>
            <h5 class="hasInvoice"><span id="Fpxg"><a href="javascript:;" class="pull-right" id="modidyInvo">修改</a></span><span class="pull-left">发票信息</span><span id="inv_ts">无</span></h5>
            <h5 class="end clearfix"><textarea class="form-control pull-right" rows="3" placeholder="请填写备注信息" id="msg"></textarea><span class="pull-left">备注信息</span></h5>
            <div class="font-color"><span>运费：</span><span class="VI-color2" id="ref_yf">￥0.00</span></div>
        </div>
    </div>
    <h4>使用积分/优惠券</h4>
    <div class="order-item order-item-discount">
                <p>最多可抵扣￥0.00元，已抵扣<input type="text" class="form-control" placeholder="0" value="0.00" id="jf" data-last-id="0.00" data-limit-id="0.00">元</p>
                <p><span id="couponshow">抵扣码及优惠券:
                                                10元优惠券
                            </span><a href="javascript:;" id="modifyCoup">选择</a></p>
    </div>

    <div class="order-item-inall">
        <p class="text-right">商品总金额：<span>￥89.80</span></p>
        <p class="text-right">运费：<span id="all_yf">￥0.00</span></p>
        <p class="text-right">商品减免：<span>￥0</span></p>
        <p class="text-right">积分抵扣：<span id="all_jf">￥0.00</span></p>
        <p class="text-right">优惠券抵扣：<span id="all_cm">￥10.00</span></p>
        <p class="text-right">其他抵扣：<span id="all_pd">￥0.00</span></p>
    </div>

    <div class="order-item-last text-right">
        <a href="javascript:void(0);" class="pull-right" id="commitOrder">提交订单</a>
        <b class="pull-right"><span id="all_total">￥79.80</span></b><span>应付金额</span>
    </div>
</section>

<div id="p-dialog">

</div>

<!--底部 -->
<!--<section class="toolbarfoot">-->
    <!--<div class="toolbar-tab tab-card" style="bottom: 71px;">-->
        <!--<a href="/web/card_change" target="_blank">-->
            <!--<i class="tab-ico"></i>-->
            <!--<em class="tab-text">券卡</em>-->
        <!--</a>-->
    <!--</div>-->
    <!--<div class="toolbar-tab tab-top">-->
        <!--<a href="#" onclick="window.open('http://p.qiao.baidu.com/im/index?siteid=7860627&ucid=6965311','','width=800,height=600')">-->
            <!--<i class="tab-ico"></i>-->
            <!--<em class="tab-text">反馈</em>-->
        <!--</a>-->
    <!--</div>-->
    <!--<div class="toolbar-tab tab-feedback">-->
        <!--<a href="javascript:scrollTo(0,0);" >-->
            <!--<i class="tab-ico"></i>-->
            <!--<em class="tab-text">顶部</em>-->
        <!--</a>-->
    <!--</div>-->
<!--</section>-->

<section class="toolbarfoot" id="tooft" style="right: 0px;">
    <a href="/web/card_change" target="_blank" class="kq"></a>
    <a href="#" class="kf"><iframe id="kf" src="/kefu" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no" width="35" height="35" style="outline: none; border: 0px none; position: fixed; bottom: 39px; right: 0px;">
    </iframe></a>
    <!--<a href="#" class="kf" onclick="window.open('http://p.qiao.baidu.com//im/index?siteid=7860483&ucid=6965311','','width=800,height=600')"></a>-->
    <a href="javascript:scrollTo(0,0);" class="return-top"></a>
</section>

	<section class="common-footer">
		<div class="content">
			<ul class="list-inline">
				<li class="footer1"></li>
				<li class="footer1"></li>
				<li class="footer1"></li>
				<li class="footer1"></li>
			</ul>
			<div class="footbar">
				<div class="logo"></div>
			</div>
		 

			<ul class="block2 list-unstyled">
                <li><img src="images/1index/ewcode1.jpg" alt=""><span>天天果园官方微信</span></li>
                <li><img src="images/1index/ewcode2.jpg" alt=""><span>天天果园APP</span></li>
            </ul>
            <ul class="block3 list-unstyled">
                <li>
                	<h4>购物指南</h4>
                    <a href="/help/index/725">新用户注册</a>
                    <a href="/help/index/726">在线下单</a>
                    <a href="/help/index/727">支付方式</a>
                </li>
                <li>
                	<h4>配送说明</h4>
                    <a href="/help/index/728">运费说明</a>
                    <a href="/help/index/729">配送方式</a>
                    <a href="/help/index/730">发票说明</a>
                </li>
                <li>
                	<h4>售后服务</h4>
                    <a href="/help/index/731">退换货规则</a>
                    <a href="/help/index/732">服务保障承诺</a>
                    <a href="/help/index/733">验货与签收</a>
                </li>
                <li>
                	<h4>企业服务</h4>
                    <a href="/help/index/734">企业订购</a>
                    <a href="/help/index/735">公司简介</a>
                    <a href="/help/index/736">定制专区</a>
                </li>
            </ul>
         </div>

         <!-- <div class="copyright text-center">
            <p class="fs-2 font-color">版权所有 © 2015天天果园&nbsp;&nbsp;保留所有权利 | 沪ICP备12042163</p>
            <p class="fs-2 VI-color2">天天果园&nbsp;&nbsp;鲜果网购</p>
            添加工商信息
                <a href="" target="_blank"><img src="images/1index/guan_shgs.gif" border="0"></a>
         
                 </div> -->
	</section>


<!-- 53 kefu  -->
<!--<iframe src="/kefu" style="width: 35px;height: 35px;outline: none;border: none;position: fixed;bottom: 36px;right: 0;">-->
<!--</iframe>-->

<!-- baidu map -->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?1c8a96ff82d41e32620cf4036a594559";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- bi -->
<iframe src="/utrace" style="width: 0;height: 0;"></iframe>


<div class="show-loading"></div>
<script src="http://www.fruitday.com/js/require.js" data-main="http://www.fruitday.com/js/main"></script>
<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>

<script>
    $(function(){
        addAddress();//新增收货地址
        modifyAddress(); //修改收货地址
        modifySendtime(); //修改发货时间
        modifyInvoice(); //修改发票信息
        modifyCoupon(); //修改优惠券
        balancepay();//余额支付
        deleteAddress();//删除收货地址
        chooseAddress();//选择地址
        useJf();//选择积分
        choosePay();//选择支付方式
        showPayMent();  //显示支付方式
        payArrival();//货到付款
    });

    //动态交互
    function showPayMent(repr_id)
    {
        var pr_id = '';

        if(repr_id ==null || repr_id =='')
        {
            pr_id = $(".order-item-addresslist .cur").find('input[name=province_id]').val();
        }
        else{
            pr_id = repr_id;
        }

        if(pr_id != null && pr_id != '')
        {
            var ds = {
                province_id:pr_id
            };
            $.ajax({
                type: 'POST',
                data: ds,
                url: "/ajax/order/getPay/",
                success : function(data){
                    if(data.code==200){
                        var ppi =0;
                        $.each(data.msg,function(key, val){
                            if(val.pay_parent_id == 4)
                            {
                                ppi =1;
                            }
                        });

                        if(ppi == 0)
                        {
                            $('#sc_payoff').css('display','none');
                        }
                        else{
                            $('#sc_payoff').css('display','block');
                        }
                    }
                },
                dataType: 'json'
            });
        }
    }
    function diaClose(){
        $('#p-dialog').removeClass().addClass('dialog-close').delay(200).fadeOut(100);
    }

    function addressResister(sta){
        var $s=$('#submit'),
                $s1=$('#submit1'),
                $subInvo = $('#subInvo'),
                $subPaper = $('#subPaper'),
                $n=$('#name'),
                $p=$('#provice'),
                $c=$('#city'),
                $a=$('#area'),
                $d=$('#detailAddr'),
                $t1=$('#tel1'),
                $t=$('#tel');
                //$ph=$('#phone');

        $s1.on('click',function(e){
            var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/,
                    _t1=$t1.val(),
                    b=true;
            if(!myreg.test(_t1)){
                $t1.addClass('hasError');
                b = false;
            }
            if (!b) {
                e.preventDefault()
            } else {
                //电子发票
                if(sta=="invoice"){
                    var tel1 = $("#tel1").val();

                    var data = {
                        'mobile':tel1
                    };

                    $.ajax({
                        type: 'POST',
                        url: '/ajax/order/setDz',
                        data: data,
                        success: function(data) {
                            if(data.code==200){
                                var ds = '';
                                $.ajax({
                                    type: 'POST',
                                    url: '/ajax/order/postFree',
                                    data: ds,
                                    success: function(data) {
                                        if(data.code==200){
                                            $('#inv_ts').text('个人');
                                            $('#ref_yf').html('￥'+data.msg.method_money);
                                            //订单信息
                                            $('#all_yf').html('￥'+data.msg.method_money);
                                            $('#all_jf').html('￥'+data.msg.jf_money);
                                            $('#all_cm').html('￥'+data.msg.card_money);
                                            $('#all_pd').html('￥'+data.msg.pay_discount);
                                            $('#all_total').html('￥'+data.msg.money);

                                            diaClose();
                                        }
                                        else
                                        {
                                            gdialog_info(data.msg);
                                        }
                                    },
                                    dataType: 'json'
                                });
                            }
                            else
                            {
                                gdialog_info(data.msg);
                            }
                        },
                        dataType: 'json'
                    });

                }
            }
        });

        //取消发票
        $subInvo.on('click',function(e) {
            var data = '';
            $.ajax({
                type: 'POST',
                url: '/ajax/order/cancelInvoice',
                data: data,
                success: function(data) {
                    if(data.code==200){
                        var ds = '';
                        $.ajax({
                            type: 'POST',
                            url: '/ajax/order/postFree',
                            data: ds,
                            success: function(data) {
                                if(data.code==200){
                                    $('#inv_ts').text('无');
                                    $('#ref_yf').html('￥'+data.msg.method_money);
                                    //订单信息
                                    $('#all_yf').html('￥'+data.msg.method_money);
                                    $('#all_jf').html('￥'+data.msg.jf_money);
                                    $('#all_cm').html('￥'+data.msg.card_money);
                                    $('#all_pd').html('￥'+data.msg.pay_discount);
                                    $('#all_total').html('￥'+data.msg.money);

                                    diaClose();
                                }
                                else
                                {
                                    gdialog_info(data.msg);
                                }
                            },
                            dataType: 'json'
                        });
                    }
                    else
                    {
                        gdialog_info(data.msg);
                    }
                },
                dataType: 'json'
            });

        });

        //纸质发票 － 收货地址（无）
        $subPaper.on('click',function(e) {

            var title = $("#title").val();

            if(title != null && title != '')
            {
                var name ='';
                var tel ='';
                var detailAddr = '';
                var provice = '';
                var city = '';
                var area = '';

                if($('#def').is(':checked'))
                {
                    name = $("#name").val();
                    tel = $("#tel").val();
                    detailAddr = $("#detailAddr").val();
                    provice = $("#provice").val();
                    city = $("#city").val();
                    area = $("#area").val();
                }

                var data = {
                    'fp':title,
                    'fp_dz':detailAddr,
                    'invoice_username':name,
                    'invoice_mobile':tel,
                    'invoice_province':provice,
                    'invoice_city':city,
                    'invoice_area':area
                };

                $.ajax({
                    type: 'POST',
                    url: '/ajax/order/selectInvoice',
                    data: data,
                    success: function(data) {
                        if(data.code==200){
                            var ds = '';
                            $.ajax({
                                type: 'POST',
                                url: '/ajax/order/postFree',
                                data: ds,
                                success: function(data) {
                                    if(data.code==200){
                                        $('#inv_ts').text(title);
                                        $('#ref_yf').html('￥'+data.msg.method_money);
                                        //订单信息
                                        $('#all_yf').html('￥'+data.msg.method_money);
                                        $('#all_jf').html('￥'+data.msg.jf_money);
                                        $('#all_cm').html('￥'+data.msg.card_money);
                                        $('#all_pd').html('￥'+data.msg.pay_discount);
                                        $('#all_total').html('￥'+data.msg.money);

                                        diaClose();
                                    }
                                    else
                                    {
                                        gdialog_info(data.msg);
                                    }
                                },
                                dataType: 'json'
                            });
                        }
                        else
                        {
                            gdialog_info(data.msg);
                        }
                    },
                    dataType: 'json'
                });
            }
            else
            {
                gdialog_info('发票抬头不能为空');
            }
        });

        $s.on('click', function(e){
            var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/;
            var b=true, _li;
            var _n=$n.val(), _p=$p.val(), _c=$c.val(), _a=$a.val(), _d=$d.val(), _t=$t.val();

            if(_n==""){
                $n.addClass('hasError');
                b = false;
            }
            if(_p==""){
                $p.parent().addClass('hasError');
                b = false;
            }
            if(_c==""){
                $c.parent().addClass('hasError');
                b = false;
            }
            if(_a==""){
                $a.parent().addClass('hasError');
                b = false;
            }
            if(_d==""){
                $d.addClass('hasError');
                b = false;
            }
            if(!myreg.test(_t)){
                $t.addClass('hasError');
                b = false;
            }

            if (!b) {
                e.preventDefault()
            } else {
                if(sta=="new"){
                    var def = $("#def").val();
                    if($('#def').is(':checked')) {
                        def =1;
                    }
                    else
                    {
                        def =0;
                    }
                    var data = {
                        'name':_n,
                        'province':_p,
                        'city':_c,
                        'area':_a,
                        'address':_d,
                        'mobile':_t,
                        'default':def
                    };
                    var url = "/ajax/order/addAddr";
                    var ares = ajaxAddArea(data,url);
                    if(ares!=0){
                        $("#orderAddressList").load(location.href+'/refaddress' + " #orderAddressList>*",function(data){
                            var addressCount = $('#orderAddressList li:gt(0)').length;
                            if(addressCount >0)
                            {
                                for(i=0;i<=addressCount;i++)
                                {
                                    $(".unfold li").eq(i).css('display','block');
                                }
                            }
                        });
                        diaClose();
                    }
                    showPayMent(_p);
                }
                if(sta=="modify"){
                    var data = {
                        'name':_n,
                        'province':_p,
                        'city':_c,
                        'area':_a,
                        'address':_d,
                        'mobile':_t,
                        'default':$("#def").val(),
                        'address_id':$("#curr_addr_id").val()
                    };
                    var url = "/ajax/order/updateAddr";
                    var ares = ajaxAddArea(data,url);
                    if(ares!=0){                   
                        $("#orderAddressList").load(location.href+'/refaddress' + " #orderAddressList>*",function(data){
                            var addressCount = $('#orderAddressList li:gt(0)').length;
                            if(addressCount >0)
                            {
                                for(i=0;i<=addressCount;i++)
                                {
                                    $(".unfold li").eq(i).css('display','block');
                                }
                            }
                        });
                        diaClose();
                    }
                    showPayMent(_p);
                }
                if(sta=="invoice"){
                    //纸质发票 -- 保存收货信息

                    var title = $("#title").val();

                    if(title != null && title != '')
                    {
                        var name = $("#name").val();
                        var tel = $("#tel").val();
                        var detailAddr = $("#detailAddr").val();
                        var provice = $("#provice").val();
                        var city = $("#city").val();
                        var area = $("#area").val();

                        var data = {
                            'fp': title,
                            'fp_dz': detailAddr,
                            'invoice_username': name,
                            'invoice_mobile': tel,
                            'invoice_province': provice,
                            'invoice_city': city,
                            'invoice_area': area
                        };
                        $.ajax({
                            type: 'POST',
                            url: '/ajax/order/selectInvoice',
                            data: data,
                            success: function (data) {
                                if (data.code == 200) {
                                    var ds = '';
                                    $.ajax({
                                        type: 'POST',
                                        url: '/ajax/order/postFree',
                                        data: ds,
                                        success: function(data) {
                                            if(data.code==200){
                                                $('#inv_ts').text(title);
                                                $('#ref_yf').html('￥'+data.msg.method_money);
                                                //订单信息
                                                $('#all_yf').html('￥'+data.msg.method_money);
                                                $('#all_jf').html('￥'+data.msg.jf_money);
                                                $('#all_cm').html('￥'+data.msg.card_money);
                                                $('#all_pd').html('￥'+data.msg.pay_discount);
                                                $('#all_total').html('￥'+data.msg.money);

                                                diaClose();
                                            }
                                            else
                                            {
                                                gdialog_info(data.msg);
                                            }
                                        },
                                        dataType: 'json'
                                    });

                                }
                                else {
                                    gdialog_info(data.msg);
                                }
                            },
                            dataType: 'json'
                        });
                    }
                    else{
                        gdialog_info('发票抬头不能为空');
                    }

                }
            }
        });

        $('#name, #detailAddr, #tel, #tel1, #phone').on('focus', function(){
            $(this).removeClass('hasError');
        })
    }

    function modifyInvoice(){
        $('.hasInvoice').delegate('#modidyInvo', 'click', function(){
            $.ajax({
                type: 'GET',
                url: "/order/invoice",
                dataType: 'html'
            }).done(function(data){
                $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');
                $('.dialog-til>span').on('click', diaClose);
                simulateSelect();
                addressResister("invoice");

                //切换发票类型
                $('.inpRadio').on('change', function(){
                    var i=$(this).index('.inpRadio');
                    $(this).parents('.dialog-con').find('form:eq('+i+')').slideDown(200).siblings('form').slideUp(200);
                });

                //发票其他地址
                $('#def').on('change', function(){
                    $(this).parent().next('div').slideToggle();
                });
            })
        })

    }

    function modifyCoupon(){
        $('#modifyCoup').on('click', function(){
            $.ajax({
                type: 'GET',
                url: "/order/coupon",
                dataType: 'html'
            }).done(function(data){
                $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');
                $('.dialog-til>span').on('click', diaClose);
                $('.dialog-couponlist>li').on('click', function(){
                    $(this).addClass('cur').siblings().removeClass('cur');

                    var cards = $(this).attr('cards');
                    $('#cardcoupon').val(cards);

//                    var data = {'card':cards};
//
//                    $.ajax({
//                        type: 'POST',
//                        url: '/ajax/order/selectUseCard',
//                        data: data,
//                        success: function(data) {
//                            if(data.code!=200){
//                                gdialog_info(data.msg);
//                            }
//                            else
//                            {
//                                $("#couponshow").text('抵扣码及优惠券:'+remarks);
//
//                                var ds = '';
//                                $.ajax({
//                                    type: 'POST',
//                                    url: '/ajax/order/postFree',
//                                    data: ds,
//                                    success: function(data) {
//                                        if(data.code==200){
//                                            //订单信息
//                                            $('#all_yf').html('￥'+data.msg.method_money);
//                                            $('#all_jf').html('￥'+data.msg.jf_money);
//                                            $('#all_cm').html('￥'+data.msg.card_money);
//                                            $('#all_pd').html('￥'+data.msg.pay_discount);
//                                            $('#all_total').html('￥'+data.msg.money);
//
//                                            //diaClose();
//                                        }
//                                        else
//                                        {
//                                            gdialog_info(data.msg);
//                                        }
//                                    },
//                                    dataType: 'json'
//                                });
//                            }
//                        },
//                        dataType: 'json'
//                    });

                });
            })
        })
    }

    function balancepay(){
        $('.order-item-last').delegate('#commitOrder', 'click', function(){
            var curr_pay = $("#orderPayList").find('.cur').attr('data-id');
            var yecode_id ='';
            if(curr_pay=='5|0'){

                var sendTime = $("#modifyTime").parent().find('p').html();
                if(sendTime == '无')
                {
                    gdialog_info('请选择配送时间');
                }
                else
                {
                    var ispay = 0;
                    //验证账户余额
                    $.ajax({
                        type: 'POST',
                        data: '',
                        url: "/ajax/order/checkUserMoney",
                        success : function(data){
                            if(data.code==200){
                                $.ajax({
                                    type: 'GET',
                                    url: "/order/register",
                                    dataType: 'html'
                                }).done(function(data){
                                    $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');
                                    $('.dialog-til>span').on('click', diaClose);

                                    $('#TestGetCode').on('click', function(){
                                        var $this=$(this);
                                        $this.find('span:eq(0)').hide().end()
                                                .find('span:eq(1)').removeClass('hide').end()
                                                .attr({'disabled':''});

                                        //发送验证码
                                        $.ajax({
                                            type: 'POST',
                                            data: '',
                                            url: "/ajax/order/sendYeCode",
                                            success : function(data){
                                                if(data.code==200){
                                                    yecode_id = data.msg;
                                                    countdown();
                                                }else{
                                                    $('#yecode').val(data.msg);
                                                }
                                            },
                                            dataType: 'json'
                                        });

                                    });

                                    $('#submit').on('click', function(){
                                        var yecode = $("#yecode").val();
                                        var sendTime = $("#modifyTime").parent().find('p').html();
                                        if(sendTime == '无')
                                        {
                                            gdialog_info('请选择配送时间');
                                        }
                                        else
                                        {
                                            if(yecode != '' && yecode != null)
                                            {
                                                var data = {
                                                    'msg': $("#msg").val(),
                                                    'yecode':yecode,
                                                    'yecode_id':yecode_id
                                                };
                                                $.ajax({
                                                    type: 'POST',
                                                    data: data,
                                                    url: "/ajax/order/createOrder",
                                                    success : function(data){
                                                        if(data.code==200){
                                                            window.location.href="/order/succ/"+data.msg;
                                                        }else{
                                                            //$('.inpText').addClass('hasError');
                                                            gdialog_info(data.msg);
                                                        }
                                                    },
                                                    dataType: 'json'
                                                });
                                            }
                                            else
                                            {
                                                //$('#pay_error_msg').text('提示：请正确输入验证码');
                                                gdialog_info('请正确输入验证码');
                                            }
                                        }
                                    });
                                    $('.inpText').on('focus', function(){
                                        //$(this).removeClass('hasError').val('');
                                        //$('#pay_error_msg').text('');
                                    })
                                });
                            }
                            else
                            {
                                gdialog_info(data.msg);
                            }
                        },
                        dataType: 'json'
                    });
                }

            }else{
                if(typeof(curr_pay)=='undefined'){
                    gdialog_info('请选择支付方式');
                    return false;
                }
                var sendTime = $("#modifyTime").parent().find('p').html();
                if(sendTime == '无')
                {
                    gdialog_info('请选择配送时间');
                    return false;
                }
                var data = {
                    'msg': $("#msg").val()
                };
                $.ajax({
                    type: 'POST',
                    data: data,
                    url: "/ajax/order/createOrder",
                    success : function(data){
                        if(data.code==200){
                            window.location.href="/order/succ/"+data.msg;
                        }else{
                            gdialog_info(data.msg);
                        }
                    },
                    dataType: 'json'
                })
            }
        });
    }

    function countdown(){
        var delay = $('#timeout').text();
        var t = setTimeout(countdown, 1000);
        if (delay > 0) {
            delay--;
            $('#timeout').text(delay);
        } else {
            clearTimeout(t);
            $('#TestGetCode').find('span:eq(0)').show().end().find('span:eq(1)').addClass('hide').end().removeAttr('disabled');
            $('#timeout').text(30);
        }
    }

    //选择支付方式
    function  choosePay(){
            $('#orderPayList>li').on('click', function(){

                var data = {'curr_pay':$(this).attr('data-id')};
                var res = ajaxChoosePay(data);
                if(res.code==200){
                    $(this).addClass('cur').siblings().removeClass('cur');
                    //支付方式是否开票

                    if(res.msg.has_invoice == 0){
                        $('#Fpxg').html('');
                        $('#inv_ts').html('无');

                        //取消发票
                        var data = '';
                        $.ajax({
                            type: 'POST',
                            url: '/ajax/order/cancelInvoice',
                            data: data,
                            success: function(data) {
                                if(data.code==200){
                                    var ds = '';
                                    $.ajax({
                                        type: 'POST',
                                        url: '/ajax/order/postFree',
                                        data: ds,
                                        success: function(data) {
                                            if(data.code==200){
                                                $('#inv_ts').text('无');
                                                $('#ref_yf').html('￥'+data.msg.method_money);
                                                //订单信息
                                                $('#all_yf').html('￥'+data.msg.method_money);
                                                $('#all_jf').html('￥'+data.msg.jf_money);
                                                $('#all_cm').html('￥'+data.msg.card_money);
                                                $('#all_pd').html('￥'+data.msg.pay_discount);
                                                $('#all_total').html('￥'+data.msg.money);

                                                diaClose();
                                            }
                                            else
                                            {
                                                gdialog_info(data.msg);
                                            }
                                        },
                                        dataType: 'json'
                                    });
                                }
                                else
                                {
                                    gdialog_info(data.msg);
                                }
                            },
                            dataType: 'json'
                        });
                    }
                    else{
                        if(res.msg.pay_parent_id == 1)
                        {
                            $('#Fpxg').html('<a href="javascript:;" class="pull-right" id="modidyInvo">修改</a>');
                        }
                    }

                }else{
                    if($(this).hasClass('balancepay'))
                    {
                        //gdialog_info("您的帐户余额不足，是否<a href='/user/recharge' target='_blank'>立即充值</a>?");
                        $('#Fpxg').html('');
                        $('#inv_ts').html('无');
                    }
                    else
                    {
                        gdialog_info(res.msg);
                    }
                }

                $(this).addClass('cur').siblings().removeClass('cur');
                if($(this).hasClass('balancepay')||$(this).children().hasClass('.payways')){
                    $(this).find('.paytips').slideDown(100);
                    $(this).siblings().find('.paytips').slideUp();
                }else{
                    $(this).siblings().find('.paytips').slideUp(100);
                }
            });
    }
    function ajaxChoosePay(data){
        var res;
        $.ajax({
              async:false,
              type: 'POST',
              url: '/ajax/order/chosePayment',
              data: data,
              success: function(data) {
                    res = data;
              },
              dataType: 'json'
        });
        return res;
    }

    //修改配送时间
    function modifySendtime(){
        $('#modifyTime').on('click', function(){

            //获取选择收货地址
            var pr_id = $(".order-item-addresslist .cur").find('input[name=province_id]').val();
            var ar_id = $(".order-item-addresslist .cur").find('input[name=area_id]').val();
            var str_adr = pr_id+'&'+ar_id
            if(pr_id == null || pr_id == '')
            {
                gdialog_info('请先选择收货地址');
                return;
            }

            $.ajax({
                type: 'GET',
                url: "/order/sendtime/"+str_adr,
                dataType: 'html'
            }).done(function(data){
                $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');
                $('#orderSendtime').delegate(' td.sel', 'click', function(){
                    $('#orderSendtime td.sel').removeClass('cur');
                    $(this).addClass('cur');
                });
                $('#dialogSendtime>li').on('click', function(){
                    $(this).addClass('cur').siblings().removeClass('cur');
                });
                $('.dialog-til>span').on('click', diaClose);
                $('#order-sendtime-cancle').on('click', diaClose);  
                $("#order-sendtime-sub").on('click',function(){
                        var hsend = '';
                        if($("#orderSendtime").length<=0){
                            var send = $(this).parent().parent().find("#dialogSendtime").find('.cur').attr('data-id');
                            hsend = '预计发货：'+$('#HideSendtime').val()+',';
                        }else{
                            var send = $(this).parent().parent().find("#orderSendtime").find('.cur').attr('data-id');
                        }
                        var data = {'send':send};
                        $.ajax({
                              type: 'POST',
                              url: '/ajax/order/choseSendtime',
                              data: data,
                              success: function(data) {
                                    if(data.code==200){
                                        var msg =hsend+data.msg;
                                        $("#modifyTime").parent().find('p').html(msg);
                                        diaClose();
                                    }
                              },
                              dataType: 'json'
                        });
                })
            })
        })
    }

    //地址选择,多级联动等
    function chooseAddress(){
        $('#orderAddressList').delegate('.tag', 'click', function(){
            var data = {'address_id':$(this).parent().find('input[name=addr_id]').val()};
            var cres = ajaxChooseAddr(data);
            if(cres.code == 200){
                $(this).parent().addClass('cur').siblings().removeClass('cur');
                $('#orderPayList>li').removeClass('cur');

                //获取送货地址
                var province_id = $(this).parent().find('input[name=province_id]').val();
                var ds = {
                    province_id:province_id
                };
                $.ajax({
                    type: 'POST',
                    data: ds,
                    url: "/ajax/order/getPay/",
                    success : function(data){
                        if(data.code==200){
                            var ppi =0;
                            $.each(data.msg,function(key, val){
                                    if(val.pay_parent_id == 4)
                                    {
                                        ppi =1;
                                    }
                            });

                            if(ppi == 0)
                            {
                                $('#sc_payoff').css('display','none');
                            }
                            else{
                                $('#sc_payoff').css('display','block');
                            }
                        }
                    },
                    dataType: 'json'
                });


            }else{
                $("#orderAddressList").load(location.href+'/refaddress' + " #orderAddressList>*",function(data){
                    var addressCount = $('#orderAddressList li:gt(0)').length;
                    if(addressCount >0)
                    {
                        for(i=0;i<=addressCount;i++)
                        {
                            $(".unfold li").eq(i).css('display','block');
                        }
                    }
                });
                gdialog_info(cres.msg);
            }
            postFree();
            $("#modifyTime").parent().find('p').html('无');
        });
    }
    function addAddress(){
        $('#newAddress').on('click', function(){
            $.ajax({
                type: 'GET',
                url: "/order/newaddr",
                dataType: 'html'
            }).done(function(data){
                    $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');
                    simulateSelect();
                    addressResister("new");
                    $('.dialog-til>span').on('click', diaClose);
            })
       });
    }
    function modifyAddress(){
        $('#orderAddressList').delegate('.modifyAddress', 'click', function(){
            var addr_id = $(this).parent().find('input[name=addr_id]').val();
            $.ajax({
                type: 'GET',
                url: "/order/modifyaddr/"+addr_id,
                dataType: 'html'
            }).done(function(data) {
                $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');
                simulateSelect();
                addressResister("modify");
                $('.dialog-til>span').on('click', diaClose);
            })
        });
    }
    function deleteAddress(){
        $('#orderAddressList').delegate('.deleteAddress', 'click', function(){
            var addr_id = $(this).parent().find('input[name=addr_id]').val();
            $.ajax({
                type: 'GET',
                url: "/order/deleteaddr/"+addr_id,
                dataType: 'html'
            }).done(function(data) {
                $('#p-dialog').empty().append(data).fadeIn(100).removeClass().addClass('dialog-open');

                $('.dialog-til>span').on('click', diaClose);
                $('#addr_del_cancle').on('click', diaClose);
                $("#addr_del_submit").on('click', function(){
                    var data = {address_id: $(this).parent().find('input[name=addr_id]').val()}
                    $.ajax({
                        type: 'POST',
                        data: data,
                        url: "/ajax/order/delAddr/",
                        success : function(data){
                            if(data.code==200){
                                diaClose();
                                $("#addr_li_"+data.msg).remove();
                                $('#sc_payoff').css('display','block');
                            }
                        },
                        dataType: 'json'
                    })
                })
            });
        });

    }
    function ajaxChooseAddr(data){
            var res;
             $.ajax({
                  async:false,
                  type: 'POST',
                  url: '/ajax/order/choseAddr',
                  data: data,
                  success: function(data) {
                        res = data;
                  },
                  dataType: 'json'
            });
             return res;        
    }
    function ajaxAddArea(jdata,url){
            var res;
             $.ajax({
                  async:false,
                  type: 'POST',
                  url: url,
                  data: jdata,
                  success: function(data) {
                        if(data.code==200){
                            res = data.msg;
                        }else{
                            res = 0;
                            gdialog_info(data.msg);
                        }
                  },
                  dataType: 'json'
            });
             return res;
    }
    function ajaxGetArea(pid, obj){
            var area_li = [];
            var data = {'pid':pid};
            $.ajax({
                async:false,
                type: 'POST',
                data: data,
                beforeSend:function(){

                },
                url: "/ajax/order/getArea/",
                success : function(data){
                    var li = "";
                    if(data.code==200){
                        $.each(data.msg,function(key, val){
                            li = li+"<li data-id="+val.id+">"+val.name+"</li>";
                        })
                        area_li[1] = li;
                    }
                },
                dataType: 'json'
            })
            return area_li;
    }

    function simulateSelect(){
        $('.inpSel').on('click', function(e){
            e.stopPropagation();
            var $this=$(this);
            if(!$this.hasClass('disabl')){
                $this.addClass('act').removeClass('hasError').
                        find('ul').slideDown(200).parent().siblings().removeClass('act').find('ul').slideUp(100).end().end()
                        .find('li').on('click', function(e){
                            e.stopPropagation();
                            var t=$(this).text();
                            var p = $(this).attr('data-id');

                            if($this.find('li').length==1){
                                $(this).addClass('cur').parent().slideUp(100).prev('span').text(t).prev('input').val(p).parent().removeClass('act');
                            }else{
                                $(this).addClass('cur').siblings().removeClass('cur').parent().slideUp(100).prev('span').text(t).prev('input').val(p).parent().removeClass('act');
                            }

                            var se_provice = $('#provice').val();
                            var se_city = $('#city').val();
                            var se_area = $('#area').val();
                            var lis = '';

                            //三级联动判断
                            if(p == se_provice)
                            {
                                $("#sparea").text('区／县');
                                $("#spcity").text('市');
                                $('#city').val('');
                                $('#area').val('');
                            }
                            else if(p == se_city)
                            {
                                $("#sparea").text('区／县');
                                $('#area').val('');
                            }

                            if(se_provice != null && se_provice !='')
                            {
                                $(this).parents('.inpSel').next('.inpSel').removeClass('disabl');
                                $("#lscity").find("li").remove();
                                lis = ajaxGetArea(se_provice);
                                $("#lscity").append(lis);
                            }

                            if(se_city != null && se_city !='')
                            {
                                $("#lsarea").find("li").remove();
                                lis = ajaxGetArea(se_city);
                                $("#lsarea").append(lis);
                            }

                            $this.find('li').off('click');
                        });
            }

        });
        $('body').on('click', function(){
            $('.inpSel').removeClass('act').find('ul').slideUp(100);
        });
    }

    //积分使用
    function useJf(){//keydown
        $('#jf').on('keyup', function(e){
                var jf = ($("#jf").attr('data-limit-id')<Math.floor($("#jf").val()))  ? $("#jf").attr('data-limit-id') : Math.floor($("#jf").val());
                if(jf!=0){
                        $.ajax({
                          type: 'POST',
                          url: '/ajax/order/useJf',
                          beforeSend:function(){
                            $("#jf").val(jf);
                          },
                          data: {'jf':jf},
                          success: function(data) {
                                if(data.code!=200){
                                    gdialog_info(data.msg);
                                    $("#jf").val($("#jf").attr('data-last-id'));
                                }else{
                                    var ds = '';
                                    $.ajax({
                                        type: 'POST',
                                        url: '/ajax/order/postFree',
                                        data: ds,
                                        success: function(data) {
                                            if(data.code==200){
                                                //订单信息
                                                $('#ref_yf').html('￥'+data.msg.method_money);
                                                $('#all_yf').html('￥'+data.msg.method_money);
                                                $('#all_jf').html('￥'+data.msg.jf_money);
                                                $('#all_cm').html('￥'+data.msg.card_money);
                                                $('#all_pd').html('￥'+data.msg.pay_discount);
                                                $('#all_total').html('￥'+data.msg.money);

                                                diaClose();
                                            }
                                            else
                                            {
                                                gdialog_info(data.msg);
                                            }
                                        },
                                        dataType: 'json'
                                    });
                                }
                          },
                          dataType: 'json'
                    });
                }else{
                    $.ajax({
                          type: 'GET',
                          url: '/ajax/order/cancelUsejf',
                          success: function(data) {
                                if(data.code!=200){
                                    gdialog_info(data.msg);
                                    $("#jf").val($("#jf").attr('data-last-id'));
                                }else{
                                    var ds = '';
                                    $.ajax({
                                        type: 'POST',
                                        url: '/ajax/order/postFree',
                                        data: ds,
                                        success: function(data) {
                                            if(data.code==200){
                                                //订单信息
                                                $('#ref_yf').html('￥'+data.msg.method_money);
                                                $('#all_yf').html('￥'+data.msg.method_money);
                                                $('#all_jf').html('￥'+data.msg.jf_money);
                                                $('#all_cm').html('￥'+data.msg.card_money);
                                                $('#all_pd').html('￥'+data.msg.pay_discount);
                                                $('#all_total').html('￥'+data.msg.money);

                                                diaClose();
                                            }
                                            else
                                            {
                                                gdialog_info(data.msg);
                                            }
                                        },
                                        dataType: 'json'
                                    });
                                }
                          },
                          dataType: 'json'
                    });
                }
        })
    }

    //验证抵扣码
    function checkCoupon()
    {
        var cardcoupon = $('#cardcoupon').val();
        if(cardcoupon != null && cardcoupon != '')
        {
            var data = {'card':cardcoupon};

            $.ajax({
                type: 'POST',
                url: '/ajax/order/selectUseCard',
                data: data,
                success: function(data) {
                    if(data.code!=200){
                        //$('#cardcoupon').val(data.msg);
                        //$('#cardcoupon').addClass('hasError').val('您的券码不符合使用条件');
                        gdialog_info(data.msg);
                    }
                    else
                    {
                        //gdialog_info('优惠券成功验证');
                        //$(".order-item-discount").load(location.href + " .order-item-discount>*");
                        var ds = '';
                        $.ajax({
                            type: 'POST',
                            url: '/ajax/order/postFree',
                            data: ds,
                            success: function(data) {
                                if(data.code==200){

                                    var remarks = $(".dialog-couponlist").find('.cur').attr('remark');
                                    $("#couponshow").text('抵扣码及优惠券:'+remarks);

                                    //订单信息
                                    $('#ref_yf').html('￥'+data.msg.method_money);
                                    $('#all_yf').html('￥'+data.msg.method_money);
                                    $('#all_jf').html('￥'+data.msg.jf_money);
                                    $('#all_cm').html('￥'+data.msg.card_money);
                                    $('#all_pd').html('￥'+data.msg.pay_discount);
                                    $('#all_total').html('￥'+data.msg.money);

                                    diaClose();
                                }
                                else
                                {
                                    //$('#cardcoupon').val(data.msg);
                                    $('#cardcoupon').addClass('hasError').val('您的券码不符合使用条件');
                                }
                            },
                            dataType: 'json'
                        });
                        diaClose();
                    }
                },
                dataType: 'json'
            });

        }
        else
        {
            $('#cardcoupon').val('');
            var ds = '';
            $.ajax({
                type: 'POST',
                url: '/ajax/order/cancelUseCard',
                data: ds,
                success: function(data) {
                    if(data.code==200){
                        var ds = '';
                        $.ajax({
                            type: 'POST',
                            url: '/ajax/order/postFree',
                            data: ds,
                            success: function(data) {
                                if(data.code==200){

                                    var remarks ='不使用优惠券';
                                    $("#couponshow").text('抵扣码及优惠券:'+remarks);

                                    //订单信息
                                    $('#ref_yf').html('￥'+data.msg.method_money);
                                    $('#all_yf').html('￥'+data.msg.method_money);
                                    $('#all_jf').html('￥'+data.msg.jf_money);
                                    $('#all_cm').html('￥'+data.msg.card_money);
                                    $('#all_pd').html('￥'+data.msg.pay_discount);
                                    $('#all_total').html('￥'+data.msg.money);

                                    diaClose();
                                }
                                else
                                {
                                    //$('#cardcoupon').val(data.msg);
                                    $('#cardcoupon').addClass('hasError').val('您的券码不符合使用条件');
                                }
                            },
                            dataType: 'json'
                        });
                    }
                    else
                    {
                        //$('#cardcoupon').val(data.msg);
                        $('#cardcoupon').addClass('hasError').val('您的券码不符合使用条件');
                    }
                },
                dataType: 'json'
            });
        }

        $('#cardcoupon').on('focus', function(){
            $(this).removeClass('hasError').val('');
        });
    }

    function payArrival(){
        $('.payways').delegate('p','click',function(e){

            var text = $(this).text();
            text = text.split("|");
            var paytext = '线下支付－'+text[0];
            var offid = '4|'+text[1];
            $('#sc_payoff').addClass('cur');
            $('#offname').html(paytext);
            $('#sc_payoff').attr('data-id',offid);

            var data = {'curr_pay':offid};
            var res = ajaxChoosePay(data);
            if(res.code==200){
                if(res.msg.has_invoice == 0){
                    $('#Fpxg').html('');
                    $('#inv_ts').html('无');

                    //取消发票
                    var data = '';
                    $.ajax({
                        type: 'POST',
                        url: '/ajax/order/cancelInvoice',
                        data: data,
                        success: function(data) {
                            if(data.code==200){
                                var ds = '';
                                $.ajax({
                                    type: 'POST',
                                    url: '/ajax/order/postFree',
                                    data: ds,
                                    success: function(data) {
                                        if(data.code==200){
                                            $('#inv_ts').text('无');
                                            $('#ref_yf').html('￥'+data.msg.method_money);
                                            //订单信息
                                            $('#all_yf').html('￥'+data.msg.method_money);
                                            $('#all_jf').html('￥'+data.msg.jf_money);
                                            $('#all_cm').html('￥'+data.msg.card_money);
                                            $('#all_pd').html('￥'+data.msg.pay_discount);
                                            $('#all_total').html('￥'+data.msg.money);

                                            diaClose();
                                        }
                                        else
                                        {
                                            gdialog_info(data.msg);
                                        }
                                    },
                                    dataType: 'json'
                                });
                            }
                            else
                            {
                                gdialog_info(data.msg);
                            }
                        },
                        dataType: 'json'
                    });
                }
                else{
                    //$('#Fpxg').html('');
                    $('#Fpxg').html('<a href="javascript:;" class="pull-right" id="modidyInvo">修改</a>');
                }

            }else{
                if($(this).hasClass('balancepay'))
                {
                    //gdialog_info("您的帐户余额不足，是否<a href='/user/recharge' target='_blank'>立即充值</a>?");
                }
                else
                {
                    gdialog_info(res.msg);
                }
            }

            $(this).addClass('curr').siblings().removeClass('curr').parent().slideUp();
            e.stopPropagation();

        });

    }

    function postFree()
    {
        var ds = '';
        $.ajax({
            type: 'POST',
            url: '/ajax/order/postFree',
            data: ds,
            success: function(data) {
                if(data.code==200){
                    //订单信息
                    $('#ref_yf').html('￥'+data.msg.method_money);
                    $('#all_yf').html('￥'+data.msg.method_money);
                    $('#all_jf').html('￥'+data.msg.jf_money);
                    $('#all_cm').html('￥'+data.msg.card_money);
                    $('#all_pd').html('￥'+data.msg.pay_discount);
                    $('#all_total').html('￥'+data.msg.money);

                    diaClose();
                }
                else
                {
                    gdialog_info(data.msg);
                }
            },
            dataType: 'json'
        });
    }

</script></body>
</html>